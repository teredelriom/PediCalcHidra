<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Hidratación Pediátrica</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .solution-card {
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }
    .solution-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .solution-card.selected {
      border-left-color: #FF3D7F;
      background-color: rgba(255, 158, 157, 0.1);
    }
    .input-highlight {
      transition: all 0.3s ease;
    }
    .input-highlight:focus {
      box-shadow: 0 0 0 3px rgba(63, 184, 175, 0.2);
      border-color: #3FB8AF;
    }
    .btn-primary {
      background-color: #FF3D7F;
      color: white;
    }
    .btn-primary:hover {
      background-color: #e83572;
    }
    .btn-secondary {
      background-color: #3FB8AF;
      color: white;
    }
    .btn-secondary:hover {
      background-color: #38a69d;
    }
    .btn-tertiary {
      background-color: #7FC7AF;
      color: white;
    }
    .btn-tertiary:hover {
      background-color: #6fb39b;
    }
  </style>
</head>
<body class="bg-[#DAD8A7] min-h-screen p-4 md:p-8">
  <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden">
    <div class="p-6 md:p-8">
      <h1 class="text-2xl md:text-3xl font-bold text-center text-[#3FB8AF] mb-6">
        <i class="fas fa-calculator mr-2"></i>Calculadora de Hidratación Pediátrica
      </h1>
      
      <!-- Formulario de entrada -->
      <div class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-[#3FB8AF] mb-1">Peso (gramos)</label>
            <div class="relative">
              <input type="number" id="peso" class="w-full input-highlight p-3 border border-gray-300 rounded-lg" placeholder="Ej: 8500" required>
              <span class="absolute right-3 top-3 text-gray-500">g</span>
            </div>
            <p class="text-xs text-gray-500 mt-1">Ingrese peso en gramos (ej. 8500 para 8kg 500g)</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-[#3FB8AF] mb-1">Edad (años)</label>
            <input type="number" id="edad" class="w-full input-highlight p-3 border border-gray-300 rounded-lg" placeholder="Ej: 2" step="0.1" min="0">
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-[#3FB8AF] mb-1">Grado de deshidratación</label>
          <select id="deshidratacion" class="w-full input-highlight p-3 border border-gray-300 rounded-lg">
            <option value="0">Sin deshidratación</option>
            <option value="50">Leve (3-5%)</option>
            <option value="75">Moderada (6-9%)</option>
            <option value="100">Severa (>10%)</option>
          </select>
        </div>

        <!-- Sección de condiciones clínicas -->
        <div>
          <label class="block text-sm font-medium text-[#3FB8AF] mb-2">Condiciones clínicas</label>
          <div id="checkboxes" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
            <!-- Checkboxes generados dinámicamente -->
          </div>
        </div>

        <!-- Botón de cálculo -->
        <button id="btnCalcular" onclick="calcular()" 
          class="w-full btn-primary font-bold py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400">
          <i class="fas fa-calculator mr-2"></i> Calcular Hidratación
        </button>
      </div>

      <!-- Sección de resultados -->
      <div id="resultado" class="hidden mt-8 space-y-6">
        <div class="bg-[#7FC7AF]/20 rounded-lg p-6 border border-[#7FC7AF]">
          <h2 class="text-xl font-bold text-[#3FB8AF] mb-4">
            <i class="fas fa-chart-bar mr-2"></i>Resultados Calculados
          </h2>
          
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-white p-4 rounded-lg shadow text-center">
              <p class="text-sm text-[#3FB8AF]">Mantenimiento</p>
              <p class="text-2xl font-bold text-[#FF3D7F]" id="mantenimientoResult">0</p>
              <p class="text-xs text-gray-500">mL/24h</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow text-center">
              <p class="text-sm text-[#3FB8AF]">Déficit</p>
              <p class="text-2xl font-bold text-[#FF3D7F]" id="deficitResult">0</p>
              <p class="text-xs text-gray-500">mL</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow text-center">
              <p class="text-sm text-[#3FB8AF]">Total 24h</p>
              <p class="text-2xl font-bold text-[#FF3D7F]" id="total24hResult">0</p>
              <p class="text-xs text-gray-500">mL</p>
            </div>
            <div class="bg-white p-4 rounded-lg shadow text-center">
              <p class="text-sm text-[#3FB8AF]">Flujo horario</p>
              <p class="text-2xl font-bold text-[#FF3D7F]" id="flujoHorarioResult">0</p>
              <p class="text-xs text-gray-500">mL/h</p>
            </div>
          </div>
        </div>

        <!-- Solución recomendada -->
        <div id="solucionRecomendadaContainer" class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="bg-[#3FB8AF] text-white p-4">
            <h3 class="text-lg font-bold flex items-center">
              <i class="fas fa-flask mr-2"></i> Solución Intravenosa Recomendada
            </h3>
          </div>
          <div id="solucionRecomendadaDetalle" class="p-4">
            <!-- Contenido generado dinámicamente -->
          </div>
        </div>

        <!-- Fórmula Holliday-Segar -->
        <div class="bg-[#DAD8A7]/50 rounded-lg p-6 border border-[#DAD8A7]">
          <h3 class="text-lg font-bold text-[#3FB8AF] mb-3">
            <i class="fas fa-info-circle mr-2 text-[#FF3D7F]"></i>Fórmula Holliday-Segar
          </h3>
          <div id="hollidayOriginal" class="text-sm">
            <!-- Contenido generado dinámicamente -->
          </div>
        </div>

        <!-- Acciones -->
        <div class="flex flex-col md:flex-row gap-4">
          <button onclick="copiarIndicaciones()" 
            class="flex-1 btn-tertiary text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
            <i class="far fa-copy mr-2"></i> Copiar Indicaciones
          </button>
          <button onclick="exportarImagen()" 
            class="flex-1 btn-secondary text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center">
            <i class="far fa-image mr-2"></i> Exportar como Imagen
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Datos iniciales
    const condicionesClinicas = [
      { id: "fiebre", label: "Fiebre (>37.5°C)" },
      { id: "ambienteCalido", label: "Ambiente caluroso (>31°C)" },
      { id: "vm", label: "Ventilación mecánica" },
      { id: "hipernatremia", label: "Hipernatremia" },
      { id: "hiponatremia", label: "Hiponatremia" },
      { id: "edema", label: "Edema" },
      { id: "oliguria", label: "Oliguria o IRA" },
      { id: "postq", label: "Postquirúrgico / Crítico" },
      { id: "desnutricion", label: "Desnutrición" },
      { id: "hipoglicemia", label: "Hipoglicemia" }
    ];

    // Inicializar checkboxes
    function inicializarCheckboxes() {
      const container = document.getElementById("checkboxes");
      condicionesClinicas.forEach(cond => {
        const div = document.createElement("div");
        div.className = "flex items-center";
        div.innerHTML = `
          <input type="checkbox" id="${cond.id}" name="condiciones" value="${cond.id}" 
            class="h-4 w-4 text-[#3FB8AF] focus:ring-[#3FB8AF] border-gray-300 rounded">
          <label for="${cond.id}" class="ml-2 text-sm text-gray-700">${cond.label}</label>
        `;
        container.appendChild(div);
      });
    }

    // Función principal de cálculo
    function calcular() {
      const peso = parseFloat(document.getElementById("peso").value);
      if (!peso || peso < 100) {
        alert("Por favor ingrese un peso válido (mínimo 100g)");
        return;
      }

      // Calcular requerimientos básicos
      const pesoKg = peso / 1000;
      const edad = parseFloat(document.getElementById("edad").value) || 0;
      const deficitPct = parseFloat(document.getElementById("deshidratacion").value);
      
      let mantenimiento = calcularMantenimiento(pesoKg);
      const deficit = pesoKg * deficitPct;
      const total24h = mantenimiento + deficit;
      
      // Actualizar UI
      document.getElementById("mantenimientoResult").textContent = Math.round(mantenimiento);
      document.getElementById("deficitResult").textContent = Math.round(deficit);
      document.getElementById("total24hResult").textContent = Math.round(total24h);
      document.getElementById("flujoHorarioResult").textContent = (mantenimiento / 24).toFixed(1);
      
      // Calcular electrolitos
      const calorias = mantenimiento;
      const glucosaReq = calorias * 0.05;
      let sodioReq = calorias * 0.03;
      let potasioReq = calorias * 0.025;
      
      // Ajustar según condiciones
      const condiciones = obtenerCondicionesSeleccionadas();
      if (condiciones.includes("hipernatremia")) sodioReq *= 0.5;
      if (condiciones.includes("hiponatremia")) sodioReq *= 1.5;
      if (condiciones.includes("edema") || condiciones.includes("oliguria")) potasioReq *= 0.5;
      
      // Calcular solución recomendada
      const solucionOptima = calcularSolucionRecomendada(
        mantenimiento, 
        sodioReq, 
        potasioReq, 
        glucosaReq,
        condiciones
      );
      
      // Mostrar fórmula Holliday-Segar
      mostrarFormulaHollidaySegar(pesoKg, mantenimiento, sodioReq, potasioReq, glucosaReq);
      
      // Mostrar resultados
      document.getElementById("resultado").classList.remove("hidden");
    }

    // Función mejorada para calcular solución recomendada
    function calcularSolucionRecomendada(mantenimiento, sodioReq, potasioReq, glucosaReq, condiciones) {
      const solucionesBase = [
        { 
          nombre: "SG 5% + NaCl 0.2%",
          descripcion: "Solución glucosada al 5% con NaCl 0.2%",
          sgPorcentaje: 5,
          naPorLitro: 34,
          glucosaPorLitro: 50,
          caloriasPorLitro: 200
        },
        { 
          nombre: "SG 5% + NaCl 0.45%",
          descripcion: "Solución glucosada al 5% con NaCl 0.45%",
          sgPorcentaje: 5,
          naPorLitro: 77,
          glucosaPorLitro: 50,
          caloriasPorLitro: 200
        },
        { 
          nombre: "SG 10% + NaCl 0.2%",
          descripcion: "Solución glucosada al 10% con NaCl 0.2%",
          sgPorcentaje: 10,
          naPorLitro: 34,
          glucosaPorLitro: 100,
          caloriasPorLitro: 400
        }
      ];
      
      // Evaluar cada solución
      const opciones = solucionesBase.map(sol => {
        const volumen = Math.min(mantenimiento, (glucosaReq * 1000) / sol.glucosaPorLitro);
        const sodioTotal = (sol.naPorLitro * volumen) / 1000;
        const diferenciaSodio = sodioTotal - sodioReq;
        
        return {
          ...sol,
          volumen: Math.round(volumen),
          sodioTotal: parseFloat(sodioTotal.toFixed(1)),
          diferenciaSodio: parseFloat(diferenciaSodio.toFixed(1)),
          adecuacion: Math.abs(diferenciaSodio)
        };
      });
      
      // Seleccionar mejor opción según condiciones
      let mejorOpcion = opciones[0];
      if (condiciones.includes("hipernatremia")) {
        mejorOpcion = opciones.reduce((prev, curr) => 
          (curr.diferenciaSodio < prev.diferenciaSodio) ? curr : prev);
      } else if (condiciones.includes("hiponatremia")) {
        mejorOpcion = opciones.reduce((prev, curr) => 
          (curr.sodioTotal > prev.sodioTotal) ? curr : prev);
      } else {
        mejorOpcion = opciones.reduce((prev, curr) => 
          (curr.adecuacion < prev.adecuacion) ? curr : prev);
      }
      
      // Calcular KCl necesario
      const kclMl = Math.round((potasioReq / 1.34) * 10) / 10;
      
      // Mostrar en UI
      mostrarSolucionRecomendada(mejorOpcion, kclMl, potasioReq, condiciones);
      
      return mejorOpcion;
    }

    // Función para mostrar la solución recomendada en la UI
    function mostrarSolucionRecomendada(solucion, kclMl, potasioReq, condiciones) {
      const container = document.getElementById("solucionRecomendadaDetalle");
      
      let notasClinicas = "";
      if (Math.abs(solucion.diferenciaSodio) > 5) {
        const esExceso = solucion.diferenciaSodio > 0;
        notasClinicas = `
          <div class="mt-4 p-3 rounded-md ${esExceso ? 'bg-[#FF9E9D]/30 border-[#FF9E9D]' : 'bg-[#7FC7AF]/30 border-[#7FC7AF]'} border">
            <p class="font-semibold ${esExceso ? 'text-[#FF3D7F]' : 'text-[#3FB8AF]'}">
              <i class="fas fa-exclamation-triangle mr-1 ${esExceso ? 'text-[#FF3D7F]' : 'text-[#3FB8AF]'}"></i>
              Nota Clínica Importante
            </p>
            <p class="mt-1 text-sm">
              Esta solución ${esExceso ? 'aporta' : 'proporciona'} ${Math.abs(solucion.diferenciaSodio).toFixed(1)} mEq 
              ${esExceso ? 'más' : 'menos'} de sodio que lo requerido.
            </p>
            ${condiciones.includes(esExceso ? 'hipernatremia' : 'hiponatremia') ? `
              <p class="mt-1 text-sm font-medium ${esExceso ? 'text-[#FF3D7F]' : 'text-[#3FB8AF]'}">
                <i class="fas fa-info-circle mr-1"></i>
                ${esExceso ? 'Considerar solución con menos sodio para hipernatremia' : 'Considerar solución con más sodio para hiponatremia'}
              </p>
            ` : ''}
          </div>
        `;
      }
      
      container.innerHTML = `
        <div class="solution-card selected p-4 mb-4">
          <h4 class="text-lg font-bold text-[#3FB8AF] mb-2">${solucion.nombre} + KCl</h4>
          <p class="text-gray-600 text-sm mb-3">${solucion.descripcion}</p>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <p class="font-semibold text-sm text-[#3FB8AF] mb-1">Composición:</p>
              <ul class="text-sm space-y-1">
                <li><span class="font-medium">Volumen total:</span> ${solucion.volumen} mL</li>
                <li><span class="font-medium">SG ${solucion.sgPorcentaje}%:</span> ${solucion.volumen} mL</li>
                <li><span class="font-medium">NaCl:</span> ${solucion.nombre.split('+')[1].trim()}</li>
                <li><span class="font-medium">KCl 10%:</span> ${kclMl} mL (${potasioReq.toFixed(1)} mEq)</li>
              </ul>
            </div>
            
            <div>
              <p class="font-semibold text-sm text-[#3FB8AF] mb-1">Aporte nutricional:</p>
              <ul class="text-sm space-y-1">
                <li><span class="font-medium">Glucosa:</span> ${((solucion.glucosaPorLitro * solucion.volumen)/1000).toFixed(1)} g</li>
                <li><span class="font-medium">Sodio:</span> ${solucion.sodioTotal} mEq</li>
                <li><span class="font-medium">Potasio:</span> ${potasioReq.toFixed(1)} mEq</li>
                <li><span class="font-medium">Calorías:</span> ${((solucion.caloriasPorLitro * solucion.volumen)/1000).toFixed(0)} kcal</li>
              </ul>
            </div>
          </div>
          
          <div class="mt-4 bg-[#DAD8A7]/20 p-3 rounded border border-[#DAD8A7]">
            <p class="font-semibold text-sm text-[#3FB8AF] mb-2">Instrucciones de preparación:</p>
            <ol class="text-sm space-y-1 pl-2">
              <li>1. Tomar ${solucion.volumen} mL de ${solucion.nombre}</li>
              <li>2. Añadir ${kclMl} mL de KCl 10% (${potasioReq.toFixed(1)} mEq de K)</li>
              <li>3. Mezclar adecuadamente antes de administrar</li>
            </ol>
            <p class="mt-2 text-sm font-medium">
              <span class="text-[#FF3D7F]">Velocidad de infusión:</span> ${(solucion.volumen / 24).toFixed(1)} mL/h
            </p>
          </div>
          
          ${notasClinicas}
        </div>
      `;
    }

    // Función para copiar indicaciones al portapapeles
    function copiarIndicaciones() {
      // Obtener datos del paciente
      const peso = parseFloat(document.getElementById("peso").value) / 1000;
      const edad = document.getElementById("edad").value || "No especificada";
      const condiciones = obtenerCondicionesSeleccionadas().join(", ") || "Ninguna";
      
      // Obtener resultados calculados
      const mantenimiento = document.getElementById("mantenimientoResult").textContent;
      const deficit = document.getElementById("deficitResult").textContent;
      const total24h = document.getElementById("total24hResult").textContent;
      const flujoHorario = document.getElementById("flujoHorarioResult").textContent;
      
      // Obtener solución recomendada
      const solucionElem = document.querySelector("#solucionRecomendadaDetalle .solution-card");
      const solucionNombre = solucionElem.querySelector("h4").textContent;
      const composicion = Array.from(solucionElem.querySelectorAll("ul:first-of-type li")).map(li => li.textContent).join('\n   • ');
      const instrucciones = Array.from(solucionElem.querySelectorAll("ol li")).map(li => li.textContent).join('\n   • ');
      const velocidad = solucionElem.querySelector("p:nth-last-of-type(2)").textContent;
      
      // Construir texto para copiar
      const textoACopiar = `INDICACIÓN DE HIDRATACIÓN PARENTERAL - PEDIATRÍA\n\n` +
                         `DATOS DEL PACIENTE\n` +
                         `• Peso: ${peso.toFixed(3)} kg\n` +
                         `• Edad: ${edad} años\n` +
                         `• Condiciones relevantes: ${condiciones}\n\n` +
                         
                         `REQUERIMIENTOS CALCULADOS\n` +
                         `• Mantenimiento: ${mantenimiento} mL/24h\n` +
                         `• Déficit: ${deficit} mL\n` +
                         `• Total 24h: ${total24h} mL\n` +
                         `• Flujo horario: ${flujoHorario} mL/h\n\n` +
                         
                         `SOLUCIÓN RECOMENDADA\n` +
                         `• ${solucionNombre}\n` +
                         `• Composición:\n   • ${composicion}\n\n` +
                         
                         `INSTRUCCIONES DE PREPARACIÓN\n` +
                         `   • ${instrucciones}\n` +
                         `   • ${velocidad}\n\n` +
                         
                         `OBSERVACIONES\n` +
                         `• Monitorizar electrolitos séricos (Na, K) cada 24h inicialmente\n` +
                         `• Controlar balance hídrico estricto\n` +
                         `• Revaluar requerimientos diariamente\n` +
                         `• Ajustar según respuesta clínica y laboratorio`;
      
      // Copiar al portapapeles
      navigator.clipboard.writeText(textoACopiar)
        .then(() => {
          const btn = document.querySelector("button[onclick='copiarIndicaciones()']");
          const originalText = btn.innerHTML;
          btn.innerHTML = '<i class="fas fa-check mr-2"></i> ¡Copiado!';
          setTimeout(() => {
            btn.innerHTML = originalText;
          }, 2000);
        })
        .catch(err => {
          console.error("Error al copiar: ", err);
          alert("No se pudo copiar al portapapeles. Intente manualmente.");
        });
    }

    // Funciones auxiliares
    function calcularMantenimiento(pesoKg) {
      if (pesoKg <= 10) return pesoKg * 100;
      if (pesoKg <= 20) return 1000 + (pesoKg - 10) * 50;
      return 1500 + (pesoKg - 20) * 20;
    }

    function obtenerCondicionesSeleccionadas() {
      return Array.from(document.querySelectorAll('#checkboxes input[type="checkbox"]:checked'))
             .map(cb => cb.value);
    }

    function mostrarFormulaHollidaySegar(pesoKg, mantenimiento, sodioReq, potasioReq, glucosaReq) {
      const container = document.getElementById("hollidayOriginal");
      
      let formula = "";
      if (pesoKg <= 10) {
        formula = `${pesoKg.toFixed(2)} kg × 100 mL/kg/día = ${(pesoKg*100).toFixed(0)} mL/día`;
      } else if (pesoKg <= 20) {
        formula = `Primeros 10kg: 1000 mL + ${(pesoKg-10).toFixed(2)} kg × 50 mL/kg/día = ${mantenimiento.toFixed(0)} mL/día`;
      } else {
        formula = `Primeros 10kg: 1000 mL + Siguientes 10kg: 500 mL + ${(pesoKg-20).toFixed(2)} kg × 20 mL/kg/día = ${mantenimiento.toFixed(0)} mL/día`;
      }
      
      container.innerHTML = `
        <p class="font-medium mb-2">Mantenimiento base:</p>
        <p class="text-sm bg-white p-2 rounded border border-[#DAD8A7] mb-4">${formula}</p>
        
        <p class="font-medium mb-2">Requerimientos diarios:</p>
        <ul class="text-sm space-y-1 list-disc pl-5">
          <li>Líquidos: ${Math.round(mantenimiento)} mL</li>
          <li>Calorías: ${Math.round(mantenimiento)} kcal</li>
          <li>Sodio: ${sodioReq.toFixed(1)} mEq (≈ ${Math.round(sodioReq * 58.44)} mg NaCl)</li>
          <li>Potasio: ${potasioReq.toFixed(1)} mEq (≈ ${Math.round(potasioReq * 74.55)} mg KCl)</li>
          <li>Glucosa: ${glucosaReq.toFixed(1)} g</li>
        </ul>
      `;
    }

    // Inicialización
    document.addEventListener("DOMContentLoaded", () => {
      inicializarCheckboxes();
      
      // Validar peso para habilitar botón de cálculo
      document.getElementById("peso").addEventListener("input", function() {
        document.getElementById("btnCalcular").disabled = !this.value || parseFloat(this.value) < 100;
      });
    });
  </script>
</body>
</html>
